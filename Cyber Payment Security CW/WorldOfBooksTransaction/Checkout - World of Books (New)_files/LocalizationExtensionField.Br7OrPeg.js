import{w as B,a as d,e6 as D,dm as $,ef as H,H as I,A as K,aJ as g,b1 as G,G as Z,eg as Q,c1 as oe,eh as ae,T as re,c3 as w,O as U,c4 as W,N as se,X as Y,K as S,y as A,c6 as ie,ei as le,ej as ce,cx as ue,ek as de,el as me,em as pe,bK as he,B as fe,en as _e,eo as be,ep as ge,C as ye,J as ve,eq as Ee,aL as Pe}from"./app.eeJKwMD1.js";import{R as Ie,u as Ce}from"./RememberMeDescriptionText.C-zLbVSU.js";function Me({defaultEmail:e}){const{record:c}=$(),{autoOptIn:t,isOptedIn:r}=H(),[s,n]=I(e),o=K(void 0),i=g(()=>{s!==o.current&&(o.current=s,c({schemaId:"shopify_pay_user_optin_ui_interaction/3.2",payload:{action:"update_email_input",email:s,source:"order_created",trigger:t&&r?"auto":"manual"}}))},[t,r,s,c]);return{value:s,handleInput:m=>{n(m)},handleBlur:()=>{i()}}}function Se({value:e,onInput:c,onBlur:t}){const r=B(),{value:s,handleInput:n,handleBlur:o}=Me({defaultEmail:e});return d(D,{type:"email",id:"email",name:"email",label:r("shop_pay_remember_me.email_label","Email"),value:s,onInput:i=>{n(i),c?.(i)},onBlur:()=>{o(),t?.()},required:!1})}function Fe(){const e=G(void 0),c=G(void 0),t=B(),r=Z(),[,s]=Q(),n=oe(),o=r.shippingAddress.fields.firstName.value,i=ae("shipping"),p=!re(()=>i??n,[i,n]).isRequired("firstName")&&!w(o),h=g(a=>{if(!w(a))return t("field_errors.address_first_name_blank","Enter a first name")},[t]),b=g(a=>{if(!p)return;if(!w(a))return c.value=U.InvalidOptInName,t("field_errors.address_first_name_blank","Enter a first name");const C=e.peek()||"";s({optInFirstName:C})},[p,e,s,t,c]),F=W(e,c,h);return se(e,c,b,U.InvalidOptInName),p?d(Y,{children:d(D,{name:"shopFirstName",label:t("contact.first_name_label","First name"),required:!0,...F})}):null}function Ne({countryCode:e,validationError:c,value:t,onBlur:r=()=>{},onInput:s=()=>{}}){const n=B(),{record:o}=$(),i=K(""),m=g(p=>{o({schemaId:"shopify_pay_user_optin_ui_interaction/3.2",payload:{action:"update_phone_input",phoneNumber:i.current,source:"order_created",trigger:p}})},[o]);return S(()=>{i.current!==t&&(i.current=t,m("auto"))},[m,t]),d(ie,{error:c?d(A,{children:n("general.errors.buyer_identity.phone_number_does_not_match_expected_pattern","The specified phone number does not match the expected pattern.")}):void 0,countryCode:e,label:n("shop_pay_remember_me.mobile_phone_number","Mobile phone number"),value:t,icon:"mobile",prefillCountryCode:!!e,onInputValueChange:p=>{s?.(p,e),i.current=p},onBlur:()=>{m("manual"),r?.()},onSelectedCountryChange:(p,h)=>{s?.(h,p),i.current=h}})}const T="RememberMeCheckbox";function Ae(){const{record:e}=$(),c=Z(),{value:t}=le(),{autoOptIn:r,isOptedIn:s}=H(),[n,o]=Q(),i=n||r&&n===void 0,m=c.phone.value,p=c.email.value,h=!m,{shopPayOptInPhone:b}=t||{},F=ce(),[a,N]=I(F),C=ue(),[_,M]=I([]),x=_.includes(T)||!!n,V=!h,{validate:P,error:L}=de(a,x,V),y=me(),v=pe(a),R=K(v),[f,X]=I(n&&n.vaultPhone||b||v||""),[O,j]=I(n&&n?.vaultEmail||p||""),k=g((u,l)=>{e({schemaId:"shopify_pay_user_optin_ui_interaction/3.2",payload:{action:u,phoneNumber:l.phone,email:l.email,source:"order_created",trigger:r&&s?"auto":"manual"}})},[e,r,s]),z=g(u=>{P(u,a)||C("violationError",{error:{message:"The specified phone number does not match the expected pattern",code:"remember_me_phone_error",field:"phone",origin:"client",type:"inline-validation"},timestamp:new Date})},[a,P,C]),J=g((u,l)=>{N(l),X(u);const E=y(u,l);o({optInPhone:E??u,optInEmail:""})},[o,y]),ee=g(u=>{j(u);const l=y(m,a);o({optInPhone:l??m,optInEmail:u})},[y,m,o,a]),ne=g(u=>{M(u);const l=u.includes(T),E=n&&n.vaultPhone||b||v||f,q=n&&n.vaultEmail||O;X(E),j(q);const te=y(E,a);o(l?{optInPhone:te??E,optInEmail:h?"":q}:!1),l&&E&&P(E,a),k(l?"click_remember_me_box":"unclick_remember_me_box",{phone:E,email:q})},[a,O,y,P,f,k,o,b,v,n,h]);return S(()=>{if(!_.includes(T)||!r)return;const u=!f||f==="",l=v||b||void 0;u&&l&&l!==R.current?(J(l,a),z(l),R.current=l):u||(R.current=l)},[_,f,a,v,b,n,J,r,k,z]),S(()=>{M(i?[T]:[])},[i]),S(()=>{x&&f&&P(f,a)},[]),S(()=>{if(e({schemaId:"shopify_pay_user_optin_ui_impression/1.0",payload:{elementType:"remember_me_box",source:"order_created"}}),r&&s){const u=h?"":O;k("click_remember_me_box",{phone:f,email:O}),o({optInPhone:f,optInEmail:u})}},[r,e,k]),d(_e,{name:"RememberMe",value:_,variant:"group",onChange:ne,children:d(he,{id:T,details:d(Y,{children:[d(Fe,{}),h?d(Ne,{countryCode:a,validationError:L,value:f,onInput:J,onBlur:()=>z(f)}):d(Se,{value:O,onInput:ee}),s?null:d(fe,{children:d(Ie,{field:h?"phone":"email",link:null})})]}),children:d(Re,{})})})}function Re(){const e=B(),c=be(),{autoOptIn:t}=H(),{inTreatment:r}=Ce();return t||r?d(A,{children:e("shop_pay_remember_me.label_shop_account","Save my information for a faster checkout with a Shop account")}):c?d(A,{children:e("shop_pay_remember_me.payment_information_only_label","Save my payment information for a faster checkout")}):d(A,{children:e("shop_pay_remember_me.label","Save my information for a faster checkout")})}function Be(){const{value:e}=ge();return!!e}function Ve({localizationExtension:e,index:c}){const t=ye(),{negotiate:r}=ve(),[s,n]=I(),[o,i]=I(),m=W(e.fields.value,t),p=e.fields.title.value,{localizedFieldErrors:h}=Ee(),b=`$.cart.localizedField.${e.peek().key}`,F=`$.localizationExtension[${c}]`,a=h.find(({target:_})=>_===b),N=_=>{const M=_.violations?.find(P=>{const{code:L,localizedMessage:y,nonLocalizedMessage:v,target:R}=P,f=y??v;if(L==="LOCALIZATION_EXTENSION_FIELD_ERROR"&&R===F)return f});if(!M)return;const{localizedMessage:x,nonLocalizedMessage:V}=M;return x??V};S(()=>{if(a){t.value=a.message;return}if(o){t.value=o;return}t.value=void 0},[t,a,o,s]);const C=()=>{m.onBlur(),n(void 0),i(void 0),r({fieldsToResolve:["localizationExtensions"],include:["localizationExtensions"],onComplete:_=>{i(N(_)),n("blur")}})};return Pe(_=>{i(N(_)),n("submit")}),d(D,{...m,label:p,name:p,onBlur:C,value:m.value??void 0})}export{Ve as L,Ae as R,Be as u};
