import{w as d,au as m,av as A,a as t,a2 as E,aw as g,ax as P,ay as h,az as N,B as C,aA as v,aB as B,X as R,aC as S,aD as w,aE as f,aF as I,aG as O,aH as D,aI as M,H as V,aJ as L,aK as U,K as k,aL as x,aM as F,W}from"./app.eeJKwMD1.js";function K(){const e=d(),{value:n}=m(),u=A()||n?.amount===0?e("review.review_and_confirm_title","Review and confirm"):e("review.review_title","Review and pay");return t(E,{level:1,autoFocus:!0,children:u})}const X=e=>t(W,{children:e});function j(){const e=g("Checkout::Actions::RenderBefore"),n=P(),{PayButton:o}=h();return t(f,{target:"cart.paymentLines[0]",children:t(N,{impressionType:"pay_now_button",impressionFeatures:[],children:[e.length!==0&&t(C,{children:[t(v,{extensions:e,render:X}),t(B,{spacing:"base"})]}),t(R,{ref:n,children:[t(b,{}),t(S,{children:t(o,{})}),t(w,{})]})]})})}const Y=new Map([["PAYMENTS_UNACCEPTABLE_PAYMENT_AMOUNT",{status:"warning",priority:-1,negotiationStage:"completion"}],["TAX_NEW_TAX_MUST_BE_ACCEPTED",{status:"warning",priority:-2,negotiationStage:"completion"}]]);function b(){const e=I(),n=q(e.value,Y);return t(f,{target:"cart.paymentLines[0]",children:n.map(o=>t(O,{notice:o,errorType:D.PaymentError},o.code))})}function q(e,n){const o=M(),[u,p]=V([]),l=L(({violations:a,negotiationStage:y})=>{const r=[],T=a.some(i=>U.has(i.code));for(const i of a)if(!H(i)&&!(T&&(i.code==="PAYMENTS_UNACCEPTABLE_PAYMENT_AMOUNT"||i.code==="TAX_NEW_TAX_MUST_BE_ACCEPTED"))&&n.has(i.code)){if(T)continue;const c=n.get(i.code);y&&y===c?.negotiationStage&&r.push({...i,tone:c?.tone,priority:c?.priority})}if(r.length>=1){const c=r.map(s=>s.priority??0).reduce((s,_)=>s>_?s:_);return r.filter(s=>(s.priority??0)>=c)}return r},[n]);return k(()=>{e&&p(l({violations:e}))},[l]),x(a=>{a.type==="complete"||a.type==="invalid"||a.type==="failed"||!o.current||p(l({violations:a.violations,negotiationStage:a.negotiationStage}))}),u.filter(F("localizedMessage"))}function H(e){return e.__typename!=="ConfirmChangeViolation"&&e.__typename!=="UnprocessableTermViolation"&&e.__typename!=="RemoveTermViolation"}export{j as P,K as R};
